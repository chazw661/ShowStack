{% load i18n admin_urls static admin_modify %}

<style>
  .galaxy-output-cell {
    padding: 5px;
    border: 1px solid #ddd;
    text-align: center;
    width: 12.5%;
    vertical-align: top;
  }
  .galaxy-output-cell .type-label {
    font-weight: bold;
    font-size: 11px;
    margin-bottom: 5px;
    color: #0066cc;
  }
  .galaxy-output-cell .label-field input {
    width: 100%;
    font-size: 11px;
    padding: 2px;
    margin-bottom: 5px;
  }
  .galaxy-output-cell select {
    width: 100%;
    font-size: 11px;
    margin-bottom: 5px;
  }
  .galaxy-output-cell .destination-field input {
    width: 100%;
    font-size: 10px;
    padding: 2px;
    border: 1px solid #ccc;
  }
  .output-type-header {
    background-color: #0066cc;
    color: white;
    padding: 5px;
    font-weight: bold;
    text-align: center;
  }
  .field-label {
    font-size: 9px;
    color: #666;
    margin-bottom: 2px;
  }
</style>

<div class="js-inline-admin-formset inline-group" id="{{ inline_admin_formset.formset.prefix }}-group">
  <div class="tabular inline-related {{ inline_admin_formset.opts.classes }}">
    {{ inline_admin_formset.formset.management_form }}
    
    <fieldset class="module {{ inline_admin_formset.classes }}">
      <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }} - Meyer GALAXY Configuration</h2>
      
      <table width="100%" cellspacing="0">
        <tbody>
          {# Row 1: Analog 1-8 #}
          <tr>
            <td colspan="8" class="output-type-header">Analog Outputs (1-8)</td>
          </tr>
          <tr class="form-row">
            {% for inline_admin_form in inline_admin_formset %}
              {% if inline_admin_form.form.instance.output_type == 'ANALOG' %}
                <td class="galaxy-output-cell">
                  {# Hidden fields #}
                  {% if inline_admin_form.fk_field %}
                    {{ inline_admin_form.fk_field.field }}
                  {% endif %}
                  {% for hidden in inline_admin_form.form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                  
                  <div class="type-label">
                    Analog {{ inline_admin_form.form.instance.channel_number }}
                  </div>
                  
                  <div class="label-field">
                    {{ inline_admin_form.form.label }}
                  </div>
                  
                  <div class="field-label">Bus:</div>
                  <div class="select">
                    {{ inline_admin_form.form.assigned_bus }}
                  </div>
                  
                  <div class="field-label">Destination:</div>
                  <div class="destination-field">
                    {{ inline_admin_form.form.destination }}
                  </div>
                </td>
              {% endif %}
            {% endfor %}
          </tr>

          {# Row 2: AES/EBU 1-8 #}
          <tr>
            <td colspan="8" class="output-type-header">AES/EBU Digital Outputs (1-8)</td>
          </tr>
          <tr class="form-row">
            {% for inline_admin_form in inline_admin_formset %}
              {% if inline_admin_form.form.instance.output_type == 'AES' %}
                <td class="galaxy-output-cell">
                  {# Hidden fields #}
                  {% if inline_admin_form.fk_field %}
                    {{ inline_admin_form.fk_field.field }}
                  {% endif %}
                  {% for hidden in inline_admin_form.form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                  
                  <div class="type-label">
                    AES {{ inline_admin_form.form.instance.channel_number }}
                  </div>
                  
                  <div class="label-field">
                    {{ inline_admin_form.form.label }}
                  </div>
                  
                  <div class="field-label">Bus:</div>
                  <div class="select">
                    {{ inline_admin_form.form.assigned_bus }}
                  </div>
                  
                  <div class="field-label">Destination:</div>
                  <div class="destination-field">
                    {{ inline_admin_form.form.destination }}
                  </div>
                </td>
              {% endif %}
            {% endfor %}
          </tr>

          {# Row 3: AVB/Milan 1-8 #}
          <tr>
            <td colspan="8" class="output-type-header">AVB/Milan Network Outputs (1-8)</td>
          </tr>
          <tr class="form-row">
            {% for inline_admin_form in inline_admin_formset %}
              {% if inline_admin_form.form.instance.output_type == 'AVB' and inline_admin_form.form.instance.channel_number <= 8 %}
                <td class="galaxy-output-cell">
                  {# Hidden fields #}
                  {% if inline_admin_form.fk_field %}
                    {{ inline_admin_form.fk_field.field }}
                  {% endif %}
                  {% for hidden in inline_admin_form.form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                  
                  <div class="type-label">
                    AVB {{ inline_admin_form.form.instance.channel_number }}
                  </div>
                  
                  <div class="label-field">
                    {{ inline_admin_form.form.label }}
                  </div>
                  
                  <div class="field-label">Bus:</div>
                  <div class="select">
                    {{ inline_admin_form.form.assigned_bus }}
                  </div>
                  
                  <div class="field-label">Destination:</div>
                  <div class="destination-field">
                    {{ inline_admin_form.form.destination }}
                  </div>
                </td>
              {% endif %}
            {% endfor %}
          </tr>

          {# Row 4: AVB/Milan 9-16 #}
          <tr>
            <td colspan="8" class="output-type-header">AVB/Milan Network Outputs (9-16)</td>
          </tr>
          <tr class="form-row">
            {% for inline_admin_form in inline_admin_formset %}
              {% if inline_admin_form.form.instance.output_type == 'AVB' and inline_admin_form.form.instance.channel_number > 8 %}
                <td class="galaxy-output-cell">
                  {# Hidden fields #}
                  {% if inline_admin_form.fk_field %}
                    {{ inline_admin_form.fk_field.field }}
                  {% endif %}
                  {% for hidden in inline_admin_form.form.hidden_fields %}
                    {{ hidden }}
                  {% endfor %}
                  
                  <div class="type-label">
                    AVB {{ inline_admin_form.form.instance.channel_number }}
                  </div>
                  
                  <div class="label-field">
                    {{ inline_admin_form.form.label }}
                  </div>
                  
                  <div class="field-label">Bus:</div>
                  <div class="select">
                    {{ inline_admin_form.form.assigned_bus }}
                  </div>
                  
                  <div class="field-label">Destination:</div>
                  <div class="destination-field">
                    {{ inline_admin_form.form.destination }}
                  </div>
                </td>
              {% endif %}
            {% endfor %}
          </tr>
        </tbody>
      </ta