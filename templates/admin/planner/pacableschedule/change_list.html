{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        /* Style the ADD PA CABLE ENTRY button */
        .object-tools li .addlink,
        .object-tools a[href*="add"] {
            background-color: #417690 !important;
            color: white !important;
            padding: 12px 24px !important;
            font-size: 15px !important;
            font-weight: 600 !important;
            border: none !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            text-decoration: none !important;
            transition: all 0.2s !important;
        }
        
        .object-tools li .addlink:hover,
        .object-tools a[href*="add"]:hover {
            background-color: #5b8ba6 !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            transform: translateY(-1px) !important;
        }
        
        /* Style the Export PDF button - smaller */
        .export-pdf-btn {
            background-color: #417690 !important;
            color: white !important;
            padding: 8px 16px !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            border: none !important;
            border-radius: 4px !important;
            text-decoration: none !important;
            display: inline-block !important;
            transition: all 0.2s !important;
        }
        
        .export-pdf-btn:hover {
            background-color: #5b8ba6 !important;
            transform: translateY(-1px) !important;
        }
    </style>
    <script>
    django.jQuery(document).ready(function($) {
        $('#result_list tbody tr').each(function() {
            var $colorDiv = $(this).find('[data-cable-color]');
            if ($colorDiv.length && $colorDiv.data('cable-color')) {
                $(this).css('background-color', $colorDiv.data('cable-color') + '33');
            }
        });
    });
    </script>
{% endblock %}

{% block object-tools-items %}
    {{ block.super }}
    <li>
        <a href="{% url 'planner:all_pa_cables_pdf_export' %}" 
           class="export-pdf-btn"
           target="_blank"
           style="background-color: #417690 !important; color: white !important; padding: 10px 20px !important;">
            EXPORT PA CABLES TO PDF
        </a>
    </li>
{% endblock %}


{% block result_list %}

{{ block.super }}

<!-- Add scoped styles that only affect cable summary tables -->
<style>
/* Scope all styles to cable-summary-section only */
.cable-summary-section {
    margin-top: 20px;
    padding: 15px;
    background: #2a2a2a;
    border: 1px solid #417690;
    border-radius: 4px;
}

.cable-summary-section h2 {
    color: #f0f0f0;
    margin-top: 0;
}

.cable-summary-section table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background: #1e1e1e;
}

.cable-summary-section thead tr {
    background: #417690 !important;
}

.cable-summary-section thead th {
    padding: 8px;
    text-align: center;
    border: 1px solid #356683;
    color: white !important;
    background: transparent;
}

.cable-summary-section thead th:first-child {
    text-align: left;
}

.cable-summary-section tbody tr {
    background: #1e1e1e;
}

.cable-summary-section tbody td {
    padding: 8px;
    text-align: center;
    border: 1px solid #333;
    color: #f0f0f0;
}

.cable-summary-section tbody td:first-child {
    text-align: left;
    font-weight: bold;
}

.cable-summary-section .safety-cells {
    background: #2a4a2a !important;
    color: #90ee90 !important;
    font-weight: bold;
}
</style>

<div class="cable-summary-section">
    <h2>Cable Summary with Ordering Calculations</h2>
    
    <table>
        <thead>
            <tr>
                <th rowspan="2">Cable Type</th>
                <th rowspan="2">Total Runs</th>
                <th rowspan="2">Total Length (ft)</th>
                <th colspan="5">CABLES NEEDED</th>
                <th colspan="5">ORDER QTY (+20% SAFETY)</th>
                <th rowspan="2">Couplers</th>
            </tr>
            <tr>
                <th>100'</th>
                <th>50'</th>
                <th>25'</th>
                <th>10'</th>
                <th>5'</th>
                <th>100'</th>
                <th>50'</th>
                <th>25'</th>
                <th>10'</th>
                <th>5'</th>
            </tr>
        </thead>
        <tbody>
            {% for cable_type, data in cable_summary.items %}
            <tr>
                <td>{{ cable_type }}</td>
                <td>{{ data.total_runs }}</td>
                <td>{{ data.total_length }}</td>
                <td>{{ data.hundreds }}</td>
                <td>{{ data.fifties }}</td>
                <td>{{ data.twenty_fives }}</td>
                <td>{{ data.tens }}</td>
                <td>{{ data.fives }}</td>
                <td class="safety-cells">{{ data.hundreds_with_safety }}</td>
                <td class="safety-cells">{{ data.fifties_with_safety }}</td>
                <td class="safety-cells">{{ data.twenty_fives_with_safety }}</td>
                <td class="safety-cells">{{ data.tens_with_safety }}</td>
                <td class="safety-cells">{{ data.fives_with_safety }}</td>
                <td>{{ data.couplers }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Fan Out Summary Section -->
    {% if fan_out_summary %}
    <div style="margin-top: 20px;">
        <h2>Fan Out Summary</h2>
        
        <table>
            <thead>
                <tr>
                    <th>FAN OUT TYPE</th>
                    <th>TOTAL QUANTITY</th>
                    <th>ORDER QTY (+20% SAFETY)</th>
                </tr>
            </thead>
            <tbody>
                {% for fan_out_type, data in fan_out_summary.items %}
                <tr>
                    <td>{{ fan_out_type }}</td>
                    <td>{{ data.total_quantity }}</td>
                    <td class="safety-cells">{{ data.with_overage }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <!-- Quick Order List -->
    {% if cable_summary %}
    <div style="margin-top: 20px; padding: 15px; background: #1e1e1e; border: 1px solid #417690; border-radius: 4px;">
        <h3 style="font-size: 18px; font-weight: bold; color: #f0f0f0; margin: 0 0 15px 0; border-bottom: 1px solid #417690; padding-bottom: 10px;">Quick Order List</h3>
        
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #417690;">
                    <th style="padding: 8px; text-align: left; color: white; border: 1px solid #356683;">Item Type</th>
                    <th style="padding: 8px; text-align: center; color: white; border: 1px solid #356683;">Length</th>
                    <th style="padding: 8px; text-align: center; color: white; border: 1px solid #356683;">Order Qty</th>
                </tr>
            </thead>
            <tbody>
                {% for cable_type, data in cable_summary.items %}
                    {% if data.hundreds_with_safety > 0 %}
                    <tr style="background: #2a2a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ cable_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">100'</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.hundreds_with_safety }}</td>
                    </tr>
                    {% endif %}
                    {% if data.fifties_with_safety > 0 %}
                    <tr style="background: #2a2a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ cable_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">50'</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.fifties_with_safety }}</td>
                    </tr>
                    {% endif %}
                    {% if data.twenty_fives_with_safety > 0 %}
                    <tr style="background: #2a2a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ cable_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">25'</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.twenty_fives_with_safety }}</td>
                    </tr>
                    {% endif %}
                    {% if data.tens_with_safety > 0 %}
                    <tr style="background: #2a2a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ cable_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">10'</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.tens_with_safety }}</td>
                    </tr>
                    {% endif %}
                    {% if data.fives_with_safety > 0 %}
                    <tr style="background: #2a2a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ cable_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">5'</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.fives_with_safety }}</td>
                    </tr>
                    {% endif %}
                {% endfor %}
                
                {% if fan_out_summary %}
                    {% for fan_out_type, data in fan_out_summary.items %}
                    <tr style="background: #2a3a2a;">
                        <td style="padding: 8px; border: 1px solid #333; color: #79aec8; font-weight: bold;">{{ fan_out_type }}</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #f0f0f0;">Fan Out</td>
                        <td style="padding: 8px; text-align: center; border: 1px solid #333; color: #90ee90; font-weight: bold;">{{ data.with_overage }}</td>
                    </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
        
        <p style="font-size: 12px; color: #90ee90; margin: 10px 0 0 0; padding: 8px; background: #2a3a2a; border-left: 3px solid #417690;">
            <strong>Note:</strong> All quantities include 20% safety margin.
        </p>
    </div>
    {% endif %}
</div>

{% endblock %}