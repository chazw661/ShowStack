{% extends "admin/change_list.html" %}
{% load static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        /* Style the ADD PA CABLE ENTRY button */
        .object-tools li .addlink,
        .object-tools a[href*="add"] {
            background-color: #417690 !important;
            color: white !important;
            padding: 12px 24px !important;
            font-size: 15px !important;
            font-weight: 600 !important;
            border: none !important;
            border-radius: 6px !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            text-decoration: none !important;
            transition: all 0.2s !important;
        }
        
        .object-tools li .addlink:hover,
        .object-tools a[href*="add"]:hover {
            background-color: #5b8ba6 !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            transform: translateY(-1px) !important;
        }
        
        /* Style the Export PDF button - smaller */
        .export-pdf-btn {
            background-color: #417690 !important;
            color: white !important;
            padding: 8px 16px !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            border: none !important;
            border-radius: 4px !important;
            text-decoration: none !important;
            display: inline-block !important;
            transition: all 0.2s !important;
        }
        
        .export-pdf-btn:hover {
            background-color: #5b8ba6 !important;
            transform: translateY(-1px) !important;
        }
    </style>
{% endblock %}

{% block object-tools-items %}
    {{ block.super }}
    <li>
        <a href="{% url 'planner:all_pa_cables_pdf_export' %}" 
           class="export-pdf-btn"
           target="_blank"
           style="background-color: #417690 !important; color: white !important; padding: 10px 20px !important;">
            EXPORT PA CABLES TO PDF
        </a>
    </li>
{% endblock %}


{% block result_list %}

{{ block.super }}

<!-- Add scoped styles that only affect cable summary tables -->
<style>
/* Scope all styles to cable-summary-section only */
.cable-summary-section {
    margin-top: 20px;
    padding: 15px;
    background: #2a2a2a;  /* Dark background for container */
    border: 1px solid #417690;
    border-radius: 4px;
}

.cable-summary-section h2 {
    color: #f0f0f0;
    margin-top: 0;
}

.cable-summary-section table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    background: #1e1e1e;
}

.cable-summary-section thead tr {
    background: #417690 !important;
}

.cable-summary-section thead th {
    padding: 8px;
    text-align: center;
    border: 1px solid #356683;
    color: white !important;
    background: transparent;
}

.cable-summary-section thead th:first-child {
    text-align: left;
}

.cable-summary-section tbody tr {
    background: #1e1e1e;
}

.cable-summary-section tbody td {
    padding: 8px;
    text-align: center;
    border: 1px solid #333;
    color: #f0f0f0;
}

.cable-summary-section tbody td:first-child {
    text-align: left;
    font-weight: bold;
}

.cable-summary-section .total-with-overage {
    font-weight: bold;
    color: #4a9eff !important;
}

.cable-summary-section .safety-cells {
    background: #2a4a2a !important;
    color: #90ee90 !important;
    font-weight: bold;
}

.cable-summary-section .order-cells,
.cable-summary-section .coupler-cells {
    background: #4a4a00 !important;
    color: #ffff99 !important;
}

.cable-summary-section .grand-total-row {
    background: #333 !important;
    font-weight: bold;
}

.cable-summary-section .grand-total-row td {
    border: 2px solid #417690;
}

.cable-summary-section .quick-order-box {
    margin-top: 20px;
    padding: 10px;
    background: #2a2a2a;
    border: 1px solid #417690;
    color: #f0f0f0;
}

.cable-summary-section .quick-order-box h3 {
    color: #f0f0f0;
    margin-top: 0;
}

.cable-summary-section .quick-order-box strong {
    color: #4a9eff;
}

.cable-summary-section .quick-order-box ul {
    margin: 5px 0;
    color: #f0f0f0;
}
</style>

<div class="cable-summary-section">
    <h2>Cable Summary with Ordering Calculations</h2>
    
    <table>
        <thead>
            <tr>
                <th rowspan="2">Cable Type</th>
                <th rowspan="2">Total Runs</th>
                <th rowspan="2">Total Length (ft)</th>
                <th colspan="5">CABLES NEEDED</th>
                <th colspan="5">ORDER QTY (+20% SAFETY)</th>
                <th rowspan="2">Couplers</th>
            </tr>
            <tr>
                <th>100'</th>
                <th>50'</th>
                <th>25'</th>
                <th>10'</th>
                <th>5'</th>
                <th>100'</th>
                <th>50'</th>
                <th>25'</th>
                <th>10'</th>
                <th>5'</th>
            </tr>
        </thead>
        <tbody>
            {% for cable_type, data in cable_summary.items %}
            <tr>
                <td>{{ cable_type }}</td>
                <td>{{ data.total_runs }}</td>
                <td>{{ data.total_length }}</td>
                <td>{{ data.hundreds }}</td>
                <td>{{ data.fifties }}</td>
                <td>{{ data.twenty_fives }}</td>
                <td>{{ data.tens }}</td>
                <td>{{ data.fives }}</td>
                <td class="safety-cells">{{ data.hundreds_with_safety }}</td>
                <td class="safety-cells">{{ data.fifties_with_safety }}</td>
                <td class="safety-cells">{{ data.twenty_fives_with_safety }}</td>
                <td class="safety-cells">{{ data.tens_with_safety }}</td>
                <td class="safety-cells">{{ data.fives_with_safety }}</td>
                <td>{{ data.couplers }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    
    <!-- Fan Out Summary Section -->
    {% if fan_out_summary %}
    <div class="cable-summary-section" style="margin-top: 20px;">
        <h2>Fan Out Summary</h2>
        
        <table>
            <thead>
                <tr>
                    <th>FAN OUT TYPE</th>
                    <th>TOTAL QUANTITY</th>
                    <th>ORDER QTY (+20% SAFETY)</th>
                </tr>
            </thead>
            <tbody>
                {% for fan_out_type, data in fan_out_summary.items %}
                <tr>
                    <td>{{ fan_out_type }}</td>
                    <td>{{ data.total_quantity }}</td>
                    <td class="safety-cells">{{ data.with_overage }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
   <!-- Ordering Summary Box -->
{% if cable_summary %}
<div class="quick-order-box">
    <h3 style="font-size: 20px; font-weight: bold;">Quick Order List</h3>
    
    <!-- Cable Orders -->
    {% for cable_type, data in cable_summary.items %}
    <div style="margin-bottom: 15px; font-size: 18px;">
        <strong style="font-size: 18px; color: #79aec8;">{{ cable_type }}:</strong>
        <ul style="font-size: 16px; line-height: 1.8;">
            {% if data.hundreds_with_safety > 0 %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.hundreds_with_safety }} × 100' lengths</li>
            {% endif %}
            {% if data.fifties_with_safety > 0 %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.fifties_with_safety }} × 50' lengths</li>
            {% endif %}
            {% if data.twenty_fives_with_safety > 0 %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.twenty_fives_with_safety }} × 25' lengths</li>
            {% endif %}
            {% if data.tens_with_safety > 0 %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.tens_with_safety }} × 10' lengths</li>
            {% endif %}
            {% if data.fives_with_safety > 0 %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.fives_with_safety }} × 5' lengths</li>
            {% endif %}
        </ul>
    </div>
    {% endfor %}
    
    <!-- Fan Out Orders -->
    {% if fan_out_summary %}
    <div style="margin-top: 20px; margin-bottom: 15px;">
        <strong style="font-size: 18px; color: #79aec8;">FAN OUTS:</strong>
        <ul style="font-size: 16px; line-height: 1.8;">
            {% for fan_out_type, data in fan_out_summary.items %}
            <li style="font-size: 16px; margin: 5px 0;">Order {{ data.with_overage }} × {{ fan_out_type }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <!-- Note about overage -->
    <div style="margin-top: 20px; padding: 10px; background-color: #2a3a2a; border-left: 3px solid #417690;">
        <p style="font-size: 14px; color: #90ee90; margin: 0;">
            <strong>Note:</strong> Cables and fan out quantities include a 20% safety margin.
        </p>
    </div>
</div>
{% endif %}
</div>

{% endblock %}