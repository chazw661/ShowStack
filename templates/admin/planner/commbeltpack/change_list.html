{% extends "admin/change_list.html" %}


{% block object-tools-items %}
    <!-- Export PDF Button -->
    <li>
        <a href="{% url 'planner:all_comm_beltpacks_pdf_export' %}" class="viewlink" target="_blank">
            Export PDF
        </a>
    </li>
    {{ block.super }}
{% endblock %}

{% block result_list %}
<div class="comm-summary" style="display: flex; justify-content: space-between; align-items: flex-start; gap: 20px; flex-wrap: wrap;">
    
    <!-- Left side: Belt Pack Summary -->
    <div style="flex: 1; min-width: 280px;">
        <h3>Belt Pack Summary</h3>
        
        <div class="system-section wireless-section">
            <h4>ðŸ“» Wireless System</h4>
            <div class="stats">
                <span class="stat">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value">{{ wireless_total }}</span>
                </span>
                <span class="stat">
                    <span class="stat-label">Checked Out:</span>
                    <span class="stat-value">{{ wireless_checked }}</span>
                </span>
                <span class="stat">
                    <span class="stat-label">Available:</span>
                    <span class="stat-value">{{ wireless_available }}</span>
                </span>
            </div>
            
            {% if wireless_groups %}
            <div class="group-stats">
                <span class="stat-label">By Group:</span>
                {% for group, count in wireless_groups.items %}
                <span class="stat mini">
                    <span class="stat-label">{{ group }}:</span>
                    <span class="stat-value">{{ count }}</span>
                </span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="system-section hardwired-section">
            <h4>ðŸ”Œ Hardwired System</h4>
            <div class="stats">
                <span class="stat">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value">{{ hardwired_total }}</span>
                </span>
            </div>
            
            {% if hardwired_groups %}
            <div class="group-stats">
                <span class="stat-label">By Group:</span>
                {% for group, count in hardwired_groups.items %}
                <span class="stat mini">
                    <span class="stat-label">{{ group }}:</span>
                    <span class="stat-value">{{ count }}</span>
                </span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Right side: Quick Links -->
    <div style="display: flex; flex-direction: column; gap: 12px; min-width: 200px;">
        <h3 style="margin: 0 0 4px 0; font-size: 13px; text-transform: uppercase; color: #888; letter-spacing: 1px;">Manage</h3>
        <a href="../commposition/" class="comm-nav-btn">
            <span class="comm-nav-icon">ðŸ“‹</span>
            <span class="comm-nav-label">Positions</span>
        </a>
        <a href="../commcrewname/" class="comm-nav-btn">
            <span class="comm-nav-icon">ðŸ‘¤</span>
            <span class="comm-nav-label">Crew Names</span>
        </a>
        <a href="../commchannel/" class="comm-nav-btn">
            <span class="comm-nav-icon">ðŸ“¡</span>
            <span class="comm-nav-label">Channels</span>
        </a>
    </div>
</div>

{{ block.super }}
{% endblock %}

{% block extrahead %}
{{ block.super }}
<style>
/* Comm Navigation Buttons */
.comm-nav-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 18px;
    background: linear-gradient(135deg, #1a2a3a 0%, #243447 100%);
    border: 1px solid #3a5068;
    border-radius: 8px;
    color: #e0e0e0;
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s ease;
    min-width: 180px;
}

.comm-nav-btn:hover {
    background: linear-gradient(135deg, #243447 0%, #2d4a63 100%);
    border-color: #4a9eff;
    color: #ffffff;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(74, 158, 255, 0.15);
}

.comm-nav-icon {
    font-size: 18px;
    width: 28px;
    text-align: center;
}

.comm-nav-label {
    font-weight: 600;
    letter-spacing: 0.3px;
}

/* Collapsible group headers */
.system-group-header {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    padding: 12px 20px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    border-left: 4px solid #3498db;
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
}

.system-group-header.wireless {
    border-left-color: #3498db;
}

.system-group-header.hardwired {
    border-left-color: #e67e22;
}

.system-group-header:hover {
    background: linear-gradient(135deg, #34495e 0%, #3d566e 100%);
}

.system-group-header .toggle-icon {
    font-size: 12px;
    transition: transform 0.3s ease;
}

.system-group-header.collapsed .toggle-icon {
    transform: rotate(-90deg);
}

.system-group-header .count-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    margin-left: 10px;
}

/* Hide collapsed rows */
tr.system-row.hidden {
    display: none !important;
}
</style>

<script>
django.jQuery(document).ready(function($) {
    var $table = $('#result_list');
    var $tbody = $table.find('tbody');
    
    // Group rows by system type
    var wirelessRows = [];
    var hardwiredRows = [];
    
    $tbody.find('tr').each(function() {
        var $row = $(this);
        // Check all cells for the BP number indicator
        var rowText = $row.text();
        
        // Look for wireless indicators (W- or antenna emoji)
        if (rowText.indexOf('W-') !== -1 || rowText.indexOf('ðŸ“¡') !== -1) {
            wirelessRows.push($row);
            $row.addClass('system-row wireless-row');
        } 
        // Look for hardwired indicators (H- or plug emoji)
        else if (rowText.indexOf('H-') !== -1 || rowText.indexOf('ðŸ”Œ') !== -1) {
            hardwiredRows.push($row);
            $row.addClass('system-row hardwired-row');
        }
    });
    
    console.log('Found wireless rows:', wirelessRows.length);
    console.log('Found hardwired rows:', hardwiredRows.length);
    
    // Only proceed if we found rows
    if (wirelessRows.length === 0 && hardwiredRows.length === 0) {
        console.log('No rows detected, skipping grouping');
        return;
    }
    
    // Create group headers
    function createGroupHeader(title, type, count) {
        var $header = $('<tr class="system-group-header-row ' + type + '">')
            .html(
                '<td colspan="20" style="padding: 0; border: none;">' +
                    '<div class="system-group-header ' + type + '" data-group="' + type + '">' +
                        '<span>' +
                            '<span class="toggle-icon">â–¼</span> ' +
                            title +
                            '<span class="count-badge">' + count + '</span>' +
                        '</span>' +
                    '</div>' +
                '</td>'
            );
        return $header;
    }
    
    // Clear tbody and rebuild with groups
    $tbody.empty();
    
    // Add Wireless group
    if (wirelessRows.length > 0) {
        var $wirelessHeader = createGroupHeader('ðŸ“¡ Wireless System', 'wireless', wirelessRows.length);
        $tbody.append($wirelessHeader);
        $.each(wirelessRows, function(i, row) {
            $tbody.append(row);
        });
    }
    
    // Add Hardwired group
    if (hardwiredRows.length > 0) {
        var $hardwiredHeader = createGroupHeader('ðŸ”Œ Hardwired System', 'hardwired', hardwiredRows.length);
        $tbody.append($hardwiredHeader);
        $.each(hardwiredRows, function(i, row) {
            $tbody.append(row);
        });
    }
    
    // Toggle functionality
    $tbody.on('click', '.system-group-header', function() {
        var $header = $(this);
        var groupType = $header.data('group');
        var $rows = $tbody.find('tr.' + groupType + '-row');
        
        $header.toggleClass('collapsed');
        
        if ($header.hasClass('collapsed')) {
            $rows.addClass('hidden');
        } else {
            $rows.removeClass('hidden');
        }
    });
});
</script>
{% endblock %}